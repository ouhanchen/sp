# 編譯器設計

## 編譯器的工作流程
編譯器將高級語言源代碼轉換為目標機器碼，通常分為多個階段進行。主要階段包括詞法分析、語法分析、語義分析、中間代碼生成、代碼優化和目標代碼生成。這些階段可以按順序依次進行，也可以在某些情況下進行交互和迭代。
#
## 詞法分析
詞法分析是編譯器的第一個階段，主要任務是將源代碼轉換為一系列詞法記號（Token），這些記號是語言的基本組成單位，如關鍵字、標識符、常量和操作符。
### 輸入和輸出

#### 輸入：
源代碼的文本字符串。
#### 輸出：
詞法記號序列，每個記號包含類型和值。
#
### 詞法分析器（Lexical Analyzer）

#### 作用：
掃描源代碼字符流，識別並提取詞法記號。
#### 技術：
通常使用有限狀態機（Finite State Machine）來實現。
#
### 常見任務

#### 過濾空白字符和注釋：
忽略空格、換行和注釋，僅關注有效記號。
#### 識別記號類型：
根據語法規則識別不同類型的記號，如關鍵字、變量名和操作符。
#

## 語法分析
語法分析是將詞法分析生成的記號序列構建為語法樹（Syntax Tree），檢查源代碼是否符合語法規則。
### 輸入和輸出

#### 輸入：
詞法記號序列。
#### 輸出：
語法樹或抽象語法樹（AST）。
#
### 語法分析器（Parser）

#### 作用：
根據語法規則構建語法樹，確保記號序列的語法正確性。
#### 技術：
常用的技術包括自上而下解析（Top-Down Parsing）和自下而上解析（Bottom-Up Parsing）。
#
### 常見解析方法

#### 遞歸下降解析：
自上而下解析方法，使用遞歸函數解析語法。
#### LR解析：
自下而上解析方法，適合更複雜的語法規則。
#

## 語義分析
語義分析檢查語法樹的語義正確性，確保程序語義符合語言規範。
### 輸入和輸出

#### 輸入：
語法樹。
#### 輸出：
注釋過的語法樹或中間表示，附帶語義信息。
#
### 語義分析器（Semantic Analyzer）

#### 作用：
檢查語法樹中的語義錯誤，如類型不匹配、未定義變量和作用域錯誤。
####　技術：
使用符號表（Symbol Table）和類型檢查等技術。
#
### 常見任務

#### 符號解析：
維護符號表，記錄變量和函數的聲明和定義。
#### 類型檢查：
檢查操作數類型和運算符是否匹配，確保類型正確性。
#

## 中間代碼生成
中間代碼生成將語法樹轉換為中間表示（Intermediate Representation，IR），中間表示是介於高級語言和機器碼之間的一種代碼形式。
### 輸入和輸出

#### 輸入：
語法樹或注釋過的語法樹。
#### 輸出：
中間代碼，如三地址碼（Three-Address Code）或靜態單賦值形式（SSA）。
#
### 中間代碼生成器（Intermediate Code Generator）

#### 作用：
生成獨立於目標機器的中間代碼，便於優化和生成機器碼。
####　技術：
根據語法樹節點生成對應的中間代碼指令。
#
### 常見中間表示

#### 三地址碼：
每條指令包含最多三個操作數，形式簡單便於優化。
#### SSA形式：
每個變量只賦值一次，便於數據流分析和優化。
#

## 代碼優化
代碼優化旨在改進中間代碼的性能，使最終生成的機器碼更高效。
### 輸入和輸出

#### 輸入：
中間代碼。
####　輸出：
優化過的中間代碼。
#
### 優化器（Optimizer）

#### 作用：
通過各種優化技術改進中間代碼的性能，降低運行時間和內存佔用。
#### 技術：
包括局部優化和全局優化技術。
#
### 常見優化技術

#### 常量折疊：
在編譯時期計算常量表達式，減少運行時計算。
#### 死代碼消除：
移除不會執行的代碼，減少不必要的運行負擔。
#### 循環優化：
如循環不變代碼外提和循環展開，減少循環開銷。
#### 代碼內聯：
將函數調用替換為函數體，減少調用開銷。
#

## 目標代碼生成
目標代碼生成將優化過的中間代碼轉換為特定機器架構的機器碼，最終生成可執行文件。
### 輸入和輸出

#### 輸入：
優化過的中間代碼。
#### 輸出：
目標機器碼或可執行文件。
#
### 目標代碼生成器（Code Generator）

#### 作用：
根據目標架構的指令集生成對應的機器碼，考慮寄存器分配和指令選擇。
#### 技術：
結合目標機器的特性生成高效的機器碼。
#
### 常見任務

#### 指令選擇：
根據中間代碼選擇合適的機器指令。
#### 寄存器分配：
分配和管理寄存器，減少內存訪問。
#### 機器碼生成：
生成最終的機器碼，並進行鏈接生成可執行文件。